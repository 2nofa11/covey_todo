<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Covey Todo - Priority Matrix</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Retro Girl Color Palette
                        tomato: '#F86247',
                        bisque: '#FFE7C6',
                        caramel: '#F6D19A',
                        iceberg: '#74B8CE',
                        // Quadrant colors
                        'quadrant-do': '#F86247',      // Tomato - Important + Urgent
                        'quadrant-plan': '#74B8CE',    // Iceberg - Important only
                        'quadrant-delegate': '#F6D19A', // Caramel - Urgent only
                        'quadrant-eliminate': '#E5E7EB' // Gray - Neither
                    },
                    fontFamily: {
                        'sans': ['Noto Sans JP', 'Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                        'inter': ['Inter', 'system-ui', 'sans-serif']
                    },
                    lineHeight: {
                        'relaxed-jp': '1.7',
                        'loose-jp': '1.8'
                    },
                    letterSpacing: {
                        'jp': '0.025em'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white min-h-screen font-sans leading-relaxed-jp tracking-jp">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-caramel">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-gray-900">Covey Todo<span class="text-lg font-normal text-gray-600 ml-2">重要度・緊急度マトリックス</span></h1>
                    <div class="hidden md:flex space-x-2">
                        <button id="todayViewBtn" class="px-3 py-1 rounded-md bg-iceberg text-white font-medium flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                            </svg>
                            <span>今日</span>
                        </button>
                        <button id="weekViewBtn" class="px-3 py-1 rounded-md bg-gray-200 text-gray-700 font-medium flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6zm0 4a1 1 0 100 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                            </svg>
                            <span>週間</span>
                        </button>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="quickCaptureBtn" class="bg-tomato hover:bg-red-600 text-white p-2 rounded-full font-bold text-xl">
                        ＋
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Quadrant Navigation -->
        <nav class="mb-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <button class="quadrant-tab active bg-quadrant-do text-white py-3 px-4 rounded-lg font-semibold flex items-center justify-between" data-quadrant="do">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"></path>
                        </svg>
                        <div>
                            <span class="block font-medium">今すぐやる</span>
                            <span class="text-xs opacity-90">重要 & 緊急</span>
                        </div>
                    </div>
                    <span class="badge bg-red-700 text-white rounded-full px-2 py-1 text-xs" id="do-count">0</span>
                </button>
                <button class="quadrant-tab bg-quadrant-plan text-white py-3 px-4 rounded-lg font-semibold flex items-center justify-between" data-quadrant="plan">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" clip-rule="evenodd"></path>
                        </svg>
                        <div>
                            <span class="block font-medium">計画する</span>
                            <span class="text-xs opacity-90">重要のみ</span>
                        </div>
                    </div>
                    <span class="badge bg-blue-700 text-white rounded-full px-2 py-1 text-xs" id="plan-count">0</span>
                </button>
                <button class="quadrant-tab bg-quadrant-delegate text-gray-800 py-3 px-4 rounded-lg font-semibold flex items-center justify-between" data-quadrant="delegate">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                        </svg>
                        <div>
                            <span class="block font-medium">人に任せる</span>
                            <span class="text-xs opacity-90">緊急のみ</span>
                        </div>
                    </div>
                    <span class="badge bg-yellow-700 text-white rounded-full px-2 py-1 text-xs" id="delegate-count">0</span>
                </button>
                <button class="quadrant-tab bg-quadrant-eliminate text-gray-700 py-3 px-4 rounded-lg font-semibold flex items-center justify-between" data-quadrant="eliminate">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"></path>
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3l1.293-1.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414L9 9V6a1 1 0 011-1z" clip-rule="evenodd"></path>
                            <path d="M3 5a2 2 0 012-2h1a1 1 0 010 2H5v6h2l1 2h4l1-2h2V5h-1a1 1 0 110-2h1a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V5z"></path>
                        </svg>
                        <div>
                            <span class="block font-medium">やらない</span>
                            <span class="text-xs opacity-90">重要でも緊急でもない</span>
                        </div>
                    </div>
                    <span class="badge bg-gray-600 text-white rounded-full px-2 py-1 text-xs" id="eliminate-count">0</span>
                </button>
            </div>
        </nav>

        <!-- Main Views -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Task Lists -->
            <div class="lg:col-span-3">
                <!-- Today View -->
                <div id="todayView" class="view-container">
                    <div class="bg-white rounded-lg shadow-md p-8 mb-8">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">今日の重点項目 <span class="text-base font-normal text-gray-600">(Today's Focus)</span></h2>
                        <div class="mb-4 bg-gray-100 rounded-lg p-3">
                            <div class="flex justify-between text-sm text-gray-600 mb-2">
                                <span>第2領域の比率 <small class="text-xs">(重要・非緊急)</small></span>
                                <span id="q2-ratio">0%</span>
                            </div>
                            <div class="w-full bg-gray-300 rounded-full h-2">
                                <div id="q2-progress" class="bg-iceberg h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div id="todayTaskList" class="space-y-3">
                            <!-- Today's tasks will be populated here -->
                        </div>
                        <div id="todayEmptyState" class="text-center py-12 hidden">
                            <div class="mb-6">
                                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-iceberg to-blue-500 rounded-full flex items-center justify-center">
                                    <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">生産性を向上させる準備はできていますか？ 🚀</h3>
                                <p class="text-gray-600 mb-6 max-w-md mx-auto">最初のタスクを追加することから始めましょう。実証済みの重要度・緊急度マトリックスを使って整理をお手伝いします。</p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto mb-6">
                                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                        <div class="flex items-center mb-2">
                                            <div class="w-6 h-6 bg-tomato rounded flex items-center justify-center mr-2">
                                                <span class="text-white text-xs font-bold">!</span>
                                            </div>
                                            <span class="font-semibold text-red-900">重要 & 緊急</span>
                                        </div>
                                        <p class="text-xs text-red-700">危機、緊急事態、期限主導のプロジェクト</p>
                                    </div>
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <div class="flex items-center mb-2">
                                            <div class="w-6 h-6 bg-iceberg rounded flex items-center justify-center mr-2">
                                                <span class="text-white text-xs font-bold">★</span>
                                            </div>
                                            <span class="font-semibold text-blue-900">重要のみ</span>
                                        </div>
                                        <p class="text-xs text-blue-700">予防、計画、個人的成長</p>
                                    </div>
                                </div>
                            </div>
                            <button onclick="openQuickCapture()" class="bg-gradient-to-r from-tomato to-iceberg hover:from-red-600 hover:to-blue-600 text-white px-8 py-3 rounded-lg font-semibold text-lg shadow-lg transform hover:scale-105 transition-all">
                                ＋ 最初のタスクを追加
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quadrant Views -->
                <div id="quadrantView" class="view-container hidden">
                    <div class="bg-white rounded-lg shadow-md p-8">
                        <h2 id="currentQuadrantTitle" class="text-xl font-bold text-gray-900 mb-8">Do - Important & Urgent</h2>
                        <div id="taskList" class="space-y-3">
                            <!-- Tasks will be populated here -->
                        </div>
                        <div id="emptyState" class="text-center py-12 text-gray-500 hidden">
                            <div class="mb-6">
                                <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
                                    <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <h3 class="text-lg font-medium text-gray-900 mb-2" id="emptyStateTitle">No tasks in this quadrant yet</h3>
                                <p class="text-sm text-gray-600 mb-4" id="emptyStateDescription">This quadrant represents tasks that are...</p>
                                <div class="bg-blue-50 rounded-lg p-4 text-left">
                                    <h4 class="font-medium text-blue-900 mb-2">💡 この領域に適したタスク例：</h4>
                                    <ul class="text-sm text-blue-800 space-y-1" id="emptyStateExamples">
                                        <li>• Example task 1</li>
                                        <li>• Example task 2</li>
                                        <li>• Example task 3</li>
                                    </ul>
                                </div>
                            </div>
                            <button onclick="openQuickCapture()" class="bg-iceberg hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium">
                                ＋ 最初のタスクを追加
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1">
                <!-- Big Rocks -->
                <div class="bg-white rounded-lg shadow-md p-8 mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">今週の重要な取り組み <span class="text-sm font-normal text-gray-600">(Big Rocks)</span></h3>
                        <button id="bigRocksBtn" class="text-iceberg hover:text-blue-700">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="bigRocksList" class="space-y-2">
                        <!-- Big rocks will be populated here -->
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="bg-white rounded-lg shadow-md p-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">簡易統計 <span class="text-sm font-normal text-gray-600">(Quick Stats)</span></h3>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">全タスク数</span>
                            <span id="total-tasks" class="font-semibold">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">今日の完了</span>
                            <span id="completed-today" class="font-semibold text-green-600">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">高優先度</span>
                            <span id="high-priority" class="font-semibold text-tomato">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Capture Modal -->
    <div id="quickCaptureModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-md border-2 border-caramel shadow-xl">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">新しいタスクを追加 <span class="text-sm font-normal text-gray-600">(Add New Task)</span></h3>
                <form id="quickCaptureForm">
                    <input 
                        type="text" 
                        id="taskInput" 
                        placeholder="何をする必要がありますか？" 
                        class="w-full px-4 py-3 border-2 border-iceberg rounded-lg focus:outline-none focus:ring-2 focus:ring-iceberg focus:border-transparent text-lg mb-4"
                        autocomplete="off"
                    >
                    
                    <!-- Priority Selection -->
                    <div class="mb-6">
                        <p class="text-sm text-gray-600 mb-3">このタスクを分類しましょう：</p>
                        <div class="grid grid-cols-2 gap-3">
                            <button type="button" id="importantToggle" class="priority-toggle flex items-center justify-center py-3 px-4 border-2 border-gray-200 rounded-lg hover:border-iceberg transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                </svg>
                                <span class="font-medium">重要</span>
                            </button>
                            <button type="button" id="urgentToggle" class="priority-toggle flex items-center justify-center py-3 px-4 border-2 border-gray-200 rounded-lg hover:border-tomato transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="font-medium">緊急</span>
                            </button>
                        </div>
                        <div id="quadrantPreview" class="mt-3 p-3 rounded-lg bg-gray-50 hidden">
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded mr-2" id="quadrantColor"></div>
                                <span class="text-sm font-medium" id="quadrantName">Neither Important nor Urgent</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1" id="quadrantDescription">Consider if this task is necessary</p>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelCapture" class="px-4 py-2 text-gray-600 hover:text-gray-800 flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                            <span>キャンセル</span>
                        </button>
                        <button type="submit" class="px-6 py-2 bg-iceberg hover:bg-blue-600 text-white rounded-lg font-medium flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                            </svg>
                            <span>タスク追加</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Big Rocks Modal -->
    <div id="bigRocksModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-2xl border-2 border-caramel max-h-[90vh] overflow-y-auto">
                <h3 class="text-xl font-semibold text-gray-900 mb-6">Weekly Big Rocks Planner</h3>
                <form id="bigRocksForm">
                    <div class="space-y-6">
                        <div class="role-section">
                            <h4 class="font-semibold text-iceberg mb-3">Work</h4>
                            <div class="space-y-2">
                                <input type="text" placeholder="Big Rock 1" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="work" data-index="0">
                                <input type="text" placeholder="Big Rock 2" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="work" data-index="1">
                                <input type="text" placeholder="Big Rock 3" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="work" data-index="2">
                            </div>
                        </div>
                        <div class="role-section">
                            <h4 class="font-semibold text-iceberg mb-3">Family</h4>
                            <div class="space-y-2">
                                <input type="text" placeholder="Big Rock 1" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="family" data-index="0">
                                <input type="text" placeholder="Big Rock 2" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="family" data-index="1">
                                <input type="text" placeholder="Big Rock 3" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="family" data-index="2">
                            </div>
                        </div>
                        <div class="role-section">
                            <h4 class="font-semibold text-iceberg mb-3">Health</h4>
                            <div class="space-y-2">
                                <input type="text" placeholder="Big Rock 1" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="health" data-index="0">
                                <input type="text" placeholder="Big Rock 2" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="health" data-index="1">
                                <input type="text" placeholder="Big Rock 3" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="health" data-index="2">
                            </div>
                        </div>
                        <div class="role-section">
                            <h4 class="font-semibold text-iceberg mb-3">Personal</h4>
                            <div class="space-y-2">
                                <input type="text" placeholder="Big Rock 1" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="personal" data-index="0">
                                <input type="text" placeholder="Big Rock 2" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="personal" data-index="1">
                                <input type="text" placeholder="Big Rock 3" class="big-rock-input w-full px-3 py-2 border border-gray-300 rounded-md" data-role="personal" data-index="2">
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" id="cancelBigRocks" class="px-4 py-2 text-gray-600 hover:text-gray-800 flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                            <span>Cancel</span>
                        </button>
                        <button type="submit" class="px-6 py-2 bg-iceberg hover:bg-blue-600 text-white rounded-lg font-medium flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" clip-rule="evenodd"></path>
                            </svg>
                            <span>Save Big Rocks</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Onboarding Tutorial Modal -->
    <div id="onboardingModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl p-8 w-full max-w-3xl shadow-2xl">
                <div id="onboardingStep1" class="onboarding-step">
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-iceberg to-blue-500 rounded-full flex items-center justify-center">
                            <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Covey Todo へようこそ！ 🎉</h2>
                        <p class="text-gray-600">実証済みの時間管理システムを 60 秒で学びましょう</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-red-50 to-blue-50 rounded-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4">重要度・緊急度マトリックス (Covey Matrix)</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-red-100 border border-red-200 rounded-lg p-4">
                                <div class="flex items-center mb-2">
                                    <div class="w-6 h-6 bg-tomato rounded flex items-center justify-center mr-3">
                                        <span class="text-white text-sm font-bold">1</span>
                                    </div>
                                    <span class="font-semibold text-red-900">今すぐやる</span>
                                </div>
                                <p class="text-sm text-red-700">重要 & 緊急<br>危機、緊急事態</p>
                            </div>
                            <div class="bg-blue-100 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-center mb-2">
                                    <div class="w-6 h-6 bg-iceberg rounded flex items-center justify-center mr-3">
                                        <span class="text-white text-sm font-bold">2</span>
                                    </div>
                                    <span class="font-semibold text-blue-900">計画する</span>
                                </div>
                                <p class="text-sm text-blue-700">重要のみ<br>予防、計画</p>
                            </div>
                            <div class="bg-yellow-100 border border-yellow-200 rounded-lg p-4">
                                <div class="flex items-center mb-2">
                                    <div class="w-6 h-6 bg-caramel rounded flex items-center justify-center mr-3">
                                        <span class="text-gray-800 text-sm font-bold">3</span>
                                    </div>
                                    <span class="font-semibold text-yellow-900">人に任せる</span>
                                </div>
                                <p class="text-sm text-yellow-700">緊急のみ<br>割り込み、妨害</p>
                            </div>
                            <div class="bg-gray-100 border border-gray-200 rounded-lg p-4">
                                <div class="flex items-center mb-2">
                                    <div class="w-6 h-6 bg-gray-400 rounded flex items-center justify-center mr-3">
                                        <span class="text-white text-sm font-bold">4</span>
                                    </div>
                                    <span class="font-semibold text-gray-700">やらない</span>
                                </div>
                                <p class="text-sm text-gray-600">どちらでもない<br>時間の無駄、些末</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <button onclick="nextOnboardingStep()" class="bg-iceberg hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold">
                            わかりました！使い方を教えてください →
                        </button>
                    </div>
                </div>

                <div id="onboardingStep2" class="onboarding-step hidden">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-tomato to-iceberg rounded-full flex items-center justify-center">
                            <span class="text-white text-2xl">✨</span>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900 mb-2">試してみましょう！</h2>
                        <p class="text-gray-600">最初のタスクを追加して、魔法を体験してください</p>
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-6 mb-6">
                        <div class="flex items-start space-x-4">
                            <div class="w-8 h-8 bg-iceberg rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                                <span class="text-white text-sm font-bold">1</span>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 mb-2">やるべきタスクを思い浮かべてください</h4>
                                <p class="text-sm text-gray-600 mb-4">例：「月曜日の会議用プレゼン資料を作る」</p>
                                <div class="bg-white rounded-lg p-4 border-2 border-dashed border-gray-300">
                                    <div class="flex items-center space-x-3">
                                        <input type="text" id="tutorialTaskInput" placeholder="ここにタスクを入力..." class="flex-1 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-iceberg">
                                        <button onclick="addTutorialTask()" class="bg-iceberg text-white px-4 py-2 rounded font-medium">追加</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between">
                        <button onclick="prevOnboardingStep()" class="text-gray-500 hover:text-gray-700">← 戻る</button>
                        <button onclick="skipOnboarding()" class="text-gray-500 hover:text-gray-700">チュートリアルをスキップ</button>
                    </div>
                </div>

                <div id="onboardingStep3" class="onboarding-step hidden">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 mx-auto mb-4 bg-green-100 rounded-full flex items-center justify-center">
                            <span class="text-green-600 text-2xl">🎯</span>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900 mb-2">素晴らしい！準備が整いました</h2>
                        <p class="text-gray-600">覚えておきたい主要機能：</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">⚡</span>
                                <span class="font-semibold">簡単追加</span>
                            </div>
                            <p class="text-sm text-gray-600"><kbd class="px-2 py-1 bg-gray-200 rounded text-xs">N</kbd>キーまたは＋ボタンで簡単にタスク追加</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">📊</span>
                                <span class="font-semibold">今日ビュー</span>
                            </div>
                            <p class="text-sm text-gray-600">今日最も大切なことに集中</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">🎯</span>
                                <span class="font-semibold">領域</span>
                            </div>
                            <p class="text-sm text-gray-600">今すぐやる/計画する/人に任せる/やらないで切り替え</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">🏔️</span>
                                <span class="font-semibold">重要な取り組み</span>
                            </div>
                            <p class="text-sm text-gray-600">役割ごとに週間優先事項を設定</p>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button onclick="finishOnboarding()" class="bg-gradient-to-r from-tomato to-iceberg hover:from-red-600 hover:to-blue-600 text-white px-8 py-3 rounded-lg font-semibold text-lg shadow-lg">
さあ、生産性を向上させましょう！ 🚀
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Weekly Review Modal -->
    <div id="weeklyReviewModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-2xl border-2 border-caramel max-h-[90vh] overflow-y-auto">
                <h3 class="text-xl font-semibold text-gray-900 mb-6">Weekly Review</h3>
                <form id="weeklyReviewForm">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">1. Percentage of Big Rocks completed this week?</label>
                            <input type="range" min="0" max="100" value="0" class="w-full" id="bigRocksPercentage">
                            <div class="text-center text-sm text-gray-600 mt-1"><span id="percentageValue">0</span>%</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">2. Most impactful Quadrant II activity?</label>
                            <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3" id="impactfulActivity"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">3. Obstacles or blockers faced?</label>
                            <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3" id="obstacles"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">4. Key lessons learned?</label>
                            <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3" id="lessons"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">5. Primary focus for the coming week?</label>
                            <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3" id="nextWeekFocus"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" id="cancelReview" class="px-4 py-2 text-gray-600 hover:text-gray-800 flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                            <span>Cancel</span>
                        </button>
                        <button type="submit" class="px-6 py-2 bg-iceberg hover:bg-blue-600 text-white rounded-lg font-medium flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            <span>Complete Review</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // App State
        let tasks = JSON.parse(localStorage.getItem('coveyTasks') || '[]');
        let bigRocks = JSON.parse(localStorage.getItem('coveyBigRocks') || '{}');
        let currentQuadrant = 'do';
        let currentView = 'today';
        let captureImportant = false;
        let captureUrgent = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            bindEvents();
            
            // Check if first time user
            if (!localStorage.getItem('coveyOnboarded')) {
                setTimeout(() => {
                    showOnboarding();
                }, 1000);
            }
            
            // Disable weekly review in development (set to false to enable)
            const isDevelopment = true;
            if (!isDevelopment) {
                checkWeeklyReview();
            }
        });

        function initializeApp() {
            renderTasks();
            renderBigRocks();
            updateStats();
            switchToTodayView();
        }

        function bindEvents() {
            // Quick Capture
            document.getElementById('quickCaptureBtn').addEventListener('click', openQuickCapture);
            document.getElementById('cancelCapture').addEventListener('click', closeQuickCapture);
            document.getElementById('quickCaptureForm').addEventListener('submit', handleQuickCapture);
            document.getElementById('importantToggle').addEventListener('click', toggleImportantCapture);
            document.getElementById('urgentToggle').addEventListener('click', toggleUrgentCapture);

            // Big Rocks
            document.getElementById('bigRocksBtn').addEventListener('click', openBigRocks);
            document.getElementById('cancelBigRocks').addEventListener('click', closeBigRocks);
            document.getElementById('bigRocksForm').addEventListener('submit', handleBigRocks);

            // Weekly Review
            document.getElementById('cancelReview').addEventListener('click', closeWeeklyReview);
            document.getElementById('weeklyReviewForm').addEventListener('submit', handleWeeklyReview);
            document.getElementById('bigRocksPercentage').addEventListener('input', updatePercentageDisplay);

            // View switching
            document.getElementById('todayViewBtn').addEventListener('click', switchToTodayView);
            document.getElementById('weekViewBtn').addEventListener('click', switchToWeekView);

            // Quadrant tabs
            document.querySelectorAll('.quadrant-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const quadrant = e.currentTarget.dataset.quadrant;
                    if (quadrant) {
                        switchQuadrant(quadrant);
                    }
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboard);

            // Modal close on escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
        }

        // Quick Capture Functions
        function openQuickCapture() {
            const modal = document.getElementById('quickCaptureModal');
            const input = document.getElementById('taskInput');
            if (modal) modal.classList.remove('hidden');
            if (input) input.focus();
        }

        function closeQuickCapture() {
            const modal = document.getElementById('quickCaptureModal');
            const input = document.getElementById('taskInput');
            if (modal) modal.classList.add('hidden');
            if (input) input.value = '';
            resetCaptureState();
        }

        function resetCaptureState() {
            captureImportant = false;
            captureUrgent = false;
            updatePriorityButtons();
            document.getElementById('quadrantPreview').classList.add('hidden');
        }

        function toggleImportantCapture() {
            captureImportant = !captureImportant;
            updatePriorityButtons();
            updateQuadrantPreview();
        }

        function toggleUrgentCapture() {
            captureUrgent = !captureUrgent;
            updatePriorityButtons();
            updateQuadrantPreview();
        }

        function updatePriorityButtons() {
            const importantBtn = document.getElementById('importantToggle');
            const urgentBtn = document.getElementById('urgentToggle');

            if (captureImportant) {
                importantBtn.classList.add('border-iceberg', 'bg-iceberg', 'text-white');
                importantBtn.classList.remove('border-gray-200', 'hover:border-iceberg');
            } else {
                importantBtn.classList.remove('border-iceberg', 'bg-iceberg', 'text-white');
                importantBtn.classList.add('border-gray-200', 'hover:border-iceberg');
            }

            if (captureUrgent) {
                urgentBtn.classList.add('border-tomato', 'bg-tomato', 'text-white');
                urgentBtn.classList.remove('border-gray-200', 'hover:border-tomato');
            } else {
                urgentBtn.classList.remove('border-tomato', 'bg-tomato', 'text-white');
                urgentBtn.classList.add('border-gray-200', 'hover:border-tomato');
            }
        }

        function updateQuadrantPreview() {
            const preview = document.getElementById('quadrantPreview');
            const colorDiv = document.getElementById('quadrantColor');
            const nameSpan = document.getElementById('quadrantName');
            const descSpan = document.getElementById('quadrantDescription');

            const quadrant = getQuadrant(captureImportant, captureUrgent);
            const quadrantInfo = {
                do: {
                    name: 'Do - Important & Urgent',
                    description: 'Handle immediately - crisis or emergency',
                    color: 'bg-tomato'
                },
                plan: {
                    name: 'Plan - Important Only',
                    description: 'Schedule for later - prevents future crises',
                    color: 'bg-iceberg'
                },
                delegate: {
                    name: 'Delegate - Urgent Only',
                    description: 'Let someone else handle this',
                    color: 'bg-caramel'
                },
                eliminate: {
                    name: 'Eliminate - Neither',
                    description: 'Consider if this task is necessary',
                    color: 'bg-gray-400'
                }
            };

            const info = quadrantInfo[quadrant];
            colorDiv.className = `w-4 h-4 rounded mr-2 ${info.color}`;
            nameSpan.textContent = info.name;
            descSpan.textContent = info.description;
            preview.classList.remove('hidden');
        }

        function handleQuickCapture(e) {
            e.preventDefault();
            const input = document.getElementById('taskInput');
            const title = input.value.trim();
            
            if (title) {
                const task = {
                    id: Date.now(),
                    title: title,
                    important: captureImportant,
                    urgent: captureUrgent,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                tasks.push(task);
                saveData();
                renderTasks();
                updateStats();
                closeQuickCapture();
                
                // Show success feedback
                showTaskAddedFeedback(getQuadrant(captureImportant, captureUrgent));
            }
        }

        function showTaskAddedFeedback(quadrant) {
            // Simple success notification (could be enhanced with animations)
            const quadrantNames = {
                do: 'Do (Important & Urgent)',
                plan: 'Plan (Important Only)', 
                delegate: 'Delegate (Urgent Only)',
                eliminate: 'Eliminate (Neither)'
            };
            
            console.log(`✅ Task added to ${quadrantNames[quadrant]} quadrant`);
        }

        // Task Management
        function getQuadrant(important, urgent) {
            if (important && urgent) return 'do';
            if (important && !urgent) return 'plan';
            if (!important && urgent) return 'delegate';
            return 'eliminate';
        }

        function toggleImportant(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.important = !task.important;
                saveData();
                renderTasks();
                updateStats();
            }
        }

        function toggleUrgent(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.urgent = !task.urgent;
                saveData();
                renderTasks();
                updateStats();
            }
        }

        function toggleCompleted(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                if (task.completed) {
                    task.completedAt = new Date().toISOString();
                }
                saveData();
                renderTasks();
                updateStats();
            }
        }

        function deleteTask(taskId) {
            tasks = tasks.filter(t => t.id !== taskId);
            saveData();
            renderTasks();
            updateStats();
        }

        // Render Functions
        function renderTasks() {
            if (currentView === 'today') {
                renderTodayView();
            } else {
                renderQuadrantView();
            }
            updateQuadrantCounts();
        }

        function renderTodayView() {
            const todayTasks = tasks.filter(t => !t.completed && (t.important || t.urgent));
            const container = document.getElementById('todayTaskList');
            const emptyState = document.getElementById('todayEmptyState');
            
            if (todayTasks.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                container.innerHTML = todayTasks.map(task => `
                    <div class="task-card bg-white border-l-4 border-${getQuadrant(task.important, task.urgent) === 'do' ? 'tomato' : 'iceberg'} p-4 rounded-lg shadow-sm">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                       onclick="toggleCompleted(${task.id})" 
                                       class="w-5 h-5 text-iceberg rounded focus:ring-iceberg">
                                <span class="${task.completed ? 'line-through text-gray-500' : 'text-gray-900'}">${task.title}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs rounded-full ${getQuadrantColor(getQuadrant(task.important, task.urgent))}">${getQuadrant(task.important, task.urgent).toUpperCase()}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // Update Q2 ratio
            const q2Tasks = todayTasks.filter(t => t.important && !t.urgent);
            const ratio = todayTasks.length > 0 ? Math.round((q2Tasks.length / todayTasks.length) * 100) : 0;
            
            const ratioElement = document.getElementById('q2-ratio');
            const progressElement = document.getElementById('q2-progress');
            
            if (ratioElement) ratioElement.textContent = ratio + '%';
            if (progressElement) progressElement.style.width = ratio + '%';
        }

        function renderQuadrantView() {
            const quadrantTasks = tasks.filter(t => getQuadrant(t.important, t.urgent) === currentQuadrant);
            const container = document.getElementById('taskList');
            const emptyState = document.getElementById('emptyState');
            
            if (quadrantTasks.length === 0) {
                container.innerHTML = '';
                updateEmptyState(currentQuadrant);
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                container.innerHTML = quadrantTasks.map(task => `
                    <div class="task-card bg-white border-2 border-gray-100 p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                       onclick="toggleCompleted(${task.id})" 
                                       class="w-5 h-5 text-iceberg rounded focus:ring-iceberg">
                                <span class="${task.completed ? 'line-through text-gray-500' : 'text-gray-900 font-medium'}">${task.title}</span>
                            </div>
                            <button onclick="deleteTask(${task.id})" class="text-gray-400 hover:text-red-500">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button onclick="toggleImportant(${task.id})" 
                                    class="flex items-center space-x-1 px-2 py-1 rounded text-sm ${task.important ? 'bg-iceberg text-white' : 'bg-gray-200 text-gray-600'}">
                                <span>★</span>
                                <span>Important</span>
                            </button>
                            <button onclick="toggleUrgent(${task.id})" 
                                    class="flex items-center space-x-1 px-2 py-1 rounded text-sm ${task.urgent ? 'bg-tomato text-white' : 'bg-gray-200 text-gray-600'}">
                                <span>⚡</span>
                                <span>Urgent</span>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateQuadrantCounts() {
            const counts = {
                do: tasks.filter(t => getQuadrant(t.important, t.urgent) === 'do' && !t.completed).length,
                plan: tasks.filter(t => getQuadrant(t.important, t.urgent) === 'plan' && !t.completed).length,
                delegate: tasks.filter(t => getQuadrant(t.important, t.urgent) === 'delegate' && !t.completed).length,
                eliminate: tasks.filter(t => getQuadrant(t.important, t.urgent) === 'eliminate' && !t.completed).length
            };

            Object.keys(counts).forEach(quadrant => {
                const element = document.getElementById(quadrant + '-count');
                if (element) {
                    element.textContent = counts[quadrant];
                }
            });
        }

        function getQuadrantColor(quadrant) {
            const colors = {
                do: 'bg-tomato text-white',
                plan: 'bg-iceberg text-white',
                delegate: 'bg-caramel text-gray-800',
                eliminate: 'bg-gray-400 text-white'
            };
            return colors[quadrant] || 'bg-gray-400 text-white';
        }

        function updateEmptyState(quadrant) {
            const quadrantInfo = {
                do: {
                    title: 'Important & Urgent Tasks',
                    description: 'Crisis situations and deadline-driven projects that need immediate attention.',
                    examples: [
                        '• Fix critical bug before product launch',
                        '• Submit tax return due tomorrow',
                        '• Handle customer emergency complaint'
                    ]
                },
                plan: {
                    title: 'Important but Not Urgent Tasks',
                    description: 'Strategic activities that prevent crises and build long-term success.',
                    examples: [
                        '• Learn new programming language',
                        '• Plan quarterly team goals',
                        '• Exercise and health maintenance'
                    ]
                },
                delegate: {
                    title: 'Urgent but Not Important Tasks',
                    description: 'Activities that seem urgent but don\'t contribute to your key goals.',
                    examples: [
                        '• Respond to non-critical emails',
                        '• Attend optional meeting',
                        '• Handle routine administrative tasks'
                    ]
                },
                eliminate: {
                    title: 'Neither Important nor Urgent',
                    description: 'Time-wasting activities that should be minimized or eliminated.',
                    examples: [
                        '• Excessive social media browsing',
                        '• Watching random YouTube videos',
                        '• Organizing already organized items'
                    ]
                }
            };

            const info = quadrantInfo[quadrant];
            document.getElementById('emptyStateTitle').textContent = info.title;
            document.getElementById('emptyStateDescription').textContent = info.description;
            
            const examplesList = document.getElementById('emptyStateExamples');
            examplesList.innerHTML = info.examples.map(example => `<li>${example}</li>`).join('');
        }

        // View Management
        function switchToTodayView() {
            currentView = 'today';
            document.getElementById('todayView').classList.remove('hidden');
            document.getElementById('quadrantView').classList.add('hidden');
            document.getElementById('todayViewBtn').classList.add('bg-iceberg', 'text-white');
            document.getElementById('todayViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('weekViewBtn').classList.remove('bg-iceberg', 'text-white');
            document.getElementById('weekViewBtn').classList.add('bg-gray-200', 'text-gray-700');
            renderTasks();
        }

        function switchToWeekView() {
            currentView = 'week';
            document.getElementById('todayView').classList.add('hidden');
            document.getElementById('quadrantView').classList.remove('hidden');
            document.getElementById('weekViewBtn').classList.add('bg-iceberg', 'text-white');
            document.getElementById('weekViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('todayViewBtn').classList.remove('bg-iceberg', 'text-white');
            document.getElementById('todayViewBtn').classList.add('bg-gray-200', 'text-gray-700');
            switchQuadrant('do');
        }

        function switchQuadrant(quadrant) {
            currentQuadrant = quadrant;
            
            // Update active tab
            document.querySelectorAll('.quadrant-tab').forEach(tab => {
                tab.classList.remove('active', 'ring-2', 'ring-offset-2');
            });
            
            const activeTab = document.querySelector(`[data-quadrant="${quadrant}"]`);
            if (activeTab) {
                activeTab.classList.add('active', 'ring-2', 'ring-offset-2');
            }
            
            // Update title
            const titles = {
                do: 'Do - Important & Urgent',
                plan: 'Plan - Important Only',
                delegate: 'Delegate - Urgent Only',
                eliminate: 'Eliminate - Neither Important nor Urgent'
            };
            
            const titleElement = document.getElementById('currentQuadrantTitle');
            if (titleElement) {
                titleElement.textContent = titles[quadrant];
            }
            
            renderTasks();
        }

        // Big Rocks Management
        function openBigRocks() {
            document.getElementById('bigRocksModal').classList.remove('hidden');
            loadBigRocksForm();
        }

        function closeBigRocks() {
            document.getElementById('bigRocksModal').classList.add('hidden');
        }

        function loadBigRocksForm() {
            document.querySelectorAll('.big-rock-input').forEach(input => {
                const role = input.dataset.role;
                const index = input.dataset.index;
                if (bigRocks[role] && bigRocks[role][index]) {
                    input.value = bigRocks[role][index];
                }
            });
        }

        function handleBigRocks(e) {
            e.preventDefault();
            
            bigRocks = {};
            document.querySelectorAll('.big-rock-input').forEach(input => {
                const role = input.dataset.role;
                const index = input.dataset.index;
                const value = input.value.trim();
                
                if (value) {
                    if (!bigRocks[role]) bigRocks[role] = [];
                    bigRocks[role][index] = value;
                }
            });
            
            localStorage.setItem('coveyBigRocks', JSON.stringify(bigRocks));
            renderBigRocks();
            closeBigRocks();
        }

        function renderBigRocks() {
            const container = document.getElementById('bigRocksList');
            const allRocks = [];
            
            Object.keys(bigRocks).forEach(role => {
                if (bigRocks[role]) {
                    bigRocks[role].forEach(rock => {
                        if (rock) allRocks.push({ role, rock });
                    });
                }
            });
            
            if (allRocks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No big rocks set for this week.</p>';
            } else {
                container.innerHTML = allRocks.map(item => `
                    <div class="bg-gray-50 p-2 rounded border-l-4 border-iceberg">
                        <div class="text-xs text-gray-500 uppercase">${item.role}</div>
                        <div class="text-sm font-medium">${item.rock}</div>
                    </div>
                `).join('');
            }
        }

        // Weekly Review
        function checkWeeklyReview() {
            const lastReview = localStorage.getItem('lastWeeklyReview');
            const now = new Date();
            
            // Calculate this Friday at 5PM
            const currentWeekFriday = new Date();
            const daysSinceFriday = (now.getDay() + 2) % 7; // Days since last Friday
            currentWeekFriday.setDate(now.getDate() - daysSinceFriday);
            currentWeekFriday.setHours(17, 0, 0, 0);
            
            // If today is before Friday 5PM, use last Friday
            if (now.getDay() < 5 || (now.getDay() === 5 && now.getHours() < 17)) {
                currentWeekFriday.setDate(currentWeekFriday.getDate() - 7);
            }
            
            // Only show if no review exists for this week or it's past Friday 5PM and no review done
            const shouldShow = !lastReview || 
                              (new Date(lastReview) < currentWeekFriday && 
                               now >= currentWeekFriday && 
                               now.getDay() === 5 && 
                               now.getHours() >= 17);
            
            if (shouldShow) {
                setTimeout(() => {
                    document.getElementById('weeklyReviewModal').classList.remove('hidden');
                }, 2000);
            }
        }

        function closeWeeklyReview() {
            document.getElementById('weeklyReviewModal').classList.add('hidden');
        }

        function handleWeeklyReview(e) {
            e.preventDefault();
            
            const review = {
                date: new Date().toISOString(),
                bigRocksPercentage: document.getElementById('bigRocksPercentage').value,
                impactfulActivity: document.getElementById('impactfulActivity').value,
                obstacles: document.getElementById('obstacles').value,
                lessons: document.getElementById('lessons').value,
                nextWeekFocus: document.getElementById('nextWeekFocus').value
            };
            
            const reviews = JSON.parse(localStorage.getItem('weeklyReviews') || '[]');
            reviews.push(review);
            localStorage.setItem('weeklyReviews', JSON.stringify(reviews));
            localStorage.setItem('lastWeeklyReview', new Date().toISOString());
            
            closeWeeklyReview();
        }

        function updatePercentageDisplay() {
            const slider = document.getElementById('bigRocksPercentage');
            document.getElementById('percentageValue').textContent = slider.value;
        }

        // Stats and Data Management
        function updateStats() {
            const totalTasks = tasks.filter(t => !t.completed).length;
            const completedToday = tasks.filter(t => t.completed && isToday(new Date(t.completedAt || t.createdAt))).length;
            const highPriority = tasks.filter(t => !t.completed && t.important && t.urgent).length;
            
            const totalElement = document.getElementById('total-tasks');
            const completedElement = document.getElementById('completed-today');
            const highPriorityElement = document.getElementById('high-priority');
            
            if (totalElement) totalElement.textContent = totalTasks;
            if (completedElement) completedElement.textContent = completedToday;
            if (highPriorityElement) highPriorityElement.textContent = highPriority;
        }

        function isToday(date) {
            const today = new Date();
            return date.getDate() === today.getDate() &&
                   date.getMonth() === today.getMonth() &&
                   date.getFullYear() === today.getFullYear();
        }

        function saveData() {
            localStorage.setItem('coveyTasks', JSON.stringify(tasks));
        }

        // Keyboard Shortcuts
        function handleKeyboard(e) {
            // Don't trigger shortcuts when typing in inputs
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            
            switch(e.key.toLowerCase()) {
                case 'n':
                    e.preventDefault();
                    openQuickCapture();
                    break;
                case 'i':
                    if (currentView === 'week') {
                        // Toggle important for selected task (simplified)
                        e.preventDefault();
                    }
                    break;
                case 'u':
                    if (currentView === 'week') {
                        // Toggle urgent for selected task (simplified)
                        e.preventDefault();
                    }
                    break;
            }
        }

        // Onboarding Functions
        let currentOnboardingStep = 1;

        function showOnboarding() {
            document.getElementById('onboardingModal').classList.remove('hidden');
            showOnboardingStep(1);
        }

        function showOnboardingStep(step) {
            // Hide all steps
            document.querySelectorAll('.onboarding-step').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show current step
            document.getElementById(`onboardingStep${step}`).classList.remove('hidden');
            currentOnboardingStep = step;
        }

        function nextOnboardingStep() {
            if (currentOnboardingStep < 3) {
                showOnboardingStep(currentOnboardingStep + 1);
            }
        }

        function prevOnboardingStep() {
            if (currentOnboardingStep > 1) {
                showOnboardingStep(currentOnboardingStep - 1);
            }
        }

        function addTutorialTask() {
            const input = document.getElementById('tutorialTaskInput');
            const taskTitle = input.value.trim();
            
            if (taskTitle) {
                // Add task to demonstrate the system
                const task = {
                    id: Date.now(),
                    title: taskTitle,
                    important: true,
                    urgent: false,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                tasks.push(task);
                saveData();
                
                // Show completion message and move to next step
                input.value = '';
                setTimeout(() => {
                    nextOnboardingStep();
                }, 500);
            }
        }

        function skipOnboarding() {
            finishOnboarding();
        }

        function finishOnboarding() {
            localStorage.setItem('coveyOnboarded', 'true');
            document.getElementById('onboardingModal').classList.add('hidden');
            renderTasks();
            updateStats();
        }

        // Utility Functions
        function closeAllModals() {
            document.getElementById('quickCaptureModal').classList.add('hidden');
            document.getElementById('bigRocksModal').classList.add('hidden');
            document.getElementById('weeklyReviewModal').classList.add('hidden');
            document.getElementById('onboardingModal').classList.add('hidden');
        }

        // Demo data (remove in production)
        function addDemoData() {
            if (tasks.length === 0) {
                tasks = [
                    { id: 1, title: "Complete quarterly review", important: true, urgent: true, completed: false, createdAt: new Date().toISOString() },
                    { id: 2, title: "Plan family vacation", important: true, urgent: false, completed: false, createdAt: new Date().toISOString() },
                    { id: 3, title: "Respond to client email", important: false, urgent: true, completed: false, createdAt: new Date().toISOString() },
                    { id: 4, title: "Organize desk", important: false, urgent: false, completed: false, createdAt: new Date().toISOString() }
                ];
                saveData();
            }
        }

        // Uncomment to add demo data
        // addDemoData();
    </script>
</body>
</html>